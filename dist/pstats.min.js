var pstats=function(){"use strict";function t(){if(typeof window.performance==="undefined"){window.performance={}}if(!window.performance.now){var t=Date.now();if(performance.timing&&performance.timing.navigationStart){t=performance.timing.navigationStart}window.performance.now=function e(){return Date.now()-t}}if(!window.performance.mark){window.performance.mark=function(){}}if(!window.performance.measure){window.performance.measure=function(){}}if(!window.performance.memory){window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}}}class e{constructor(t,e){this._color=e||"#666";this._max=0;this._current=0;this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvasDot=document.createElement("canvas");this._ctxDot=this._canvasDot.getContext("2d");this._canvasAlarm=document.createElement("canvas"),this._ctxAlarm=this._canvasAlarm.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,e){this._canvas.width=t;this._canvas.height=e;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${e}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height);this._canvasDot.width=1;this._canvasDot.height=2*e;this._ctxDot.fillStyle="#444";this._ctxDot.fillRect(0,0,1,2*e);this._ctxDot.fillStyle=this._color;this._ctxDot.fillRect(0,e,1,e);this._ctxDot.fillStyle="#fff";this._ctxDot.globalAlpha=.5;this._ctxDot.fillRect(0,e,1,1);this._ctxDot.globalAlpha=1;this._canvasAlarm.width=1;this._canvasAlarm.height=2*e;this._ctxAlarm.fillStyle="#444";this._ctxAlarm.fillRect(0,0,1,2*e);this._ctxAlarm.fillStyle="#b70000";this._ctxAlarm.fillRect(0,e,1,e);this._ctxAlarm.globalAlpha=.5;this._ctxAlarm.fillStyle="#fff";this._ctxAlarm.fillRect(0,e,1,1);this._ctxAlarm.globalAlpha=1}draw(t,e){this._current+=(t-this._current)*.1;this._max*=.99;if(this._current>this._max){this._max=this._current}this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(e){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,-this._canvas.height*this._current/this._max)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,-this._canvas.height*this._current/this._max)}}}class i{constructor(t,e){this._colors=e;this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,e,i){this._canvas.width=t;this._canvas.height=e*i;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${e*i}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,t,e*i)}draw(t){this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);let e=0;for(let i=0;i<t.length;++i){let n=t[i]*this._canvas.height;this._ctx.fillStyle=this._colors[i];this._ctx.fillRect(this._canvas.width-1,e,1,n);e+=n}}}class n{constructor(t,e){this._id=t;this._opts=e||{};this._value=0;this._total=0;this._averageValue=0;this._accumValue=0;this._accumSamples=0;this._accumStart=window.performance.now()}_average(t){if(this._opts.average){this._accumValue+=t;++this._accumSamples;let e=performance.now();if(e-this._accumStart>=this._opts.average){this._averageValue=this._accumValue/this._accumSamples;this._accumValue=0;this._accumStart=e;this._accumSamples=0}}}get value(){return this._value}set value(t){this._value=t}sample(){this._average(this._value)}human(){let t=this._opts.average?this._averageValue:this._value;return Math.round(t*100)/100}alarm(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}}class s extends n{constructor(t,e){super(t,e);this._time=performance.now()}start(){this._time=window.performance.now()}end(){this._value=window.performance.now()-this._time;this._average(this._value)}tick(){this.end();this.start()}frame(){let t=window.performance.now();let e=t-this._time;this._total++;let i=this._opts.average||1e3;if(e>i){this._value=this._total*1e3/e;this._total=0;this._time=t;this._average(this._value)}}}const a=Math.log(1024);const o=["Bytes","KB","MB","GB","TB"];function h(t){let e=100;let i=Math.floor(Math.log(t)/a);if(t===0){return"n/a"}return Math.round(t*e/Math.pow(1024,i))/e+" "+o[i]}class c extends n{constructor(t,e,i){super(e,i);this._stats=t;this._start=0;if(i.extension.indexOf("memory.")===0){this._field=i.extension.substring(7)}}snapshot(){this._value=this._stats[this._field]}start(){this._start=this._stats[this._field]}end(){this._value=this._stats[this._field]-this._start}human(){return h(super.human())}}class r{constructor(){let t=window.performance.memory;if(t.totalJSHeapSize===0){console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome.")}this._used=0;this._total=0;this._lastUsed=0}tick(){let t=window.performance.memory.usedJSHeapSize;this._lastUsed=this._used;this._used=t;this._total=window.performance.memory.totalJSHeapSize}get alarm(){return this._used-this._lastUsed<0}get used(){return this._used}get total(){return this._total}counter(t,e){return new c(this,t,e)}}let l=false;let u=0;let _=0;let f=0;let m=0;let d=0;let p=0;let v=0;function g(){if(l){return}l=true;function t(t,e){return function(){e.apply(this,arguments);t.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=t(WebGLRenderingContext.prototype.drawArrays,function(){u++;if(arguments[0]==this.POINTS)p+=arguments[2];else d+=arguments[2]});WebGLRenderingContext.prototype.drawElements=t(WebGLRenderingContext.prototype.drawElements,function(){_++;m+=arguments[1]/3;d+=arguments[1]});WebGLRenderingContext.prototype.useProgram=t(WebGLRenderingContext.prototype.useProgram,function(){f++});WebGLRenderingContext.prototype.bindTexture=t(WebGLRenderingContext.prototype.bindTexture,function(){v++})}class w extends n{constructor(t,e,i){super(e,i);this._stats=t;this._start=0;if(i.extension.indexOf("webgl.")===0){this._field=i.extension.substring(6)}}snapshot(){this._value=this._stats[this._field]}start(){this._start=this._stats[this._field]}end(){this._value=this._stats[this._field]-this._start}}class x{constructor(){g()}tick(){u=0;_=0;f=0;m=0;d=0;p=0;v=0}counter(t,e){return new w(this,t,e)}get drawcalls(){return u+_}get drawArrays(){return u}get drawElements(){return _}get faces(){return m}get vertices(){return d}get points(){return p}get programs(){return f}get textures(){return v}}let y={memory:r,webgl:x};let S=100;let C=10;let b=`
  .pstats {
    position: absolute;
    z-index: 9999;

    padding: 5px;
    width: ${S+150}px;
    right: 0;
    bottom: 0;

    font-size: 10px;
    font-family: 'Roboto Condensed', tahoma, sans-serif;
    overflow: hidden;
    user-select: none;
    cursor: default;

    background: #222;
    border-radius: 3px;

  }

  .pstats-container {
    display: flex;
    flex-direction: column;
    color: #888;
    white-space: nowrap;
  }

  .pstats-item {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .pstats-label {
    display: flex;
    flex-direction: row;
    flex: 1;

    text-align: left;
    margin-right: 5px;

    transition: background 0.3s;
  }

  .pstats-label.alarm {
    color: #ccc;
    background: #800;

    transition: background 0s;
  }

  .pstats-counter-id {
    flex: 1;
  }

  .pstats-counter-value {
    flex: 1;
    text-align: right;
  }

  .pstats-fraction {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .pstats-legend {
    display: flex;
    flex-direction: column;
    flex: 1;

    text-align: right;
    margin-right: 5px;
  }
`;let A=document.createElement("style");A.type="text/css";A.textContent=b;document.head.appendChild(A);class E{constructor(t,n){n=n||{};this._colors=n.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];this._values=n.values||{};this._fractions=n.fractions||[];this._id2counter={};this._id2item={};this._name2extStats={};if(n.css){let t=document.createElement("style");t.type="text/css";t.textContent=n.css;document.head.appendChild(t)}if(n.extensions){for(let t=0;t<n.extensions.length;++t){let e=n.extensions[t];let i=y[e];if(!i){console.warn(`Can not find extensions ${e}, please register your extension via pstats.register().`);continue}this._name2extStats[e]=new i}}this._root=document.createElement("div");this._root.className="pstats";let s=document.createElement("div");s.className="pstats-container";this._root.appendChild(s);for(let t in this._values){let i=this._values[t];let n=document.createElement("div");n.className="pstats-item";let a=document.createElement("div");a.className="pstats-label";let o=document.createElement("span");o.className="pstats-counter-id";o.textContent=i.desc||t;let h=document.createElement("div");h.className="pstats-counter-value";let c=document.createTextNode("");c.nodeValue="0";a.appendChild(o);a.appendChild(h);h.appendChild(c);n.appendChild(a);let r=new e(n,i.color);r.init(S,C);this._id2item[t]={label:a,valueText:c,graph:r};s.appendChild(n)}if(n.fractions){for(let t=0;t<n.fractions.length;++t){let e=n.fractions[t];let a=document.createElement("div");a.className="pstats-fraction";let o=document.createElement("div");o.className="pstats-legend";let h=e.steps;for(let t=0;t<h.length;++t){let e=document.createElement("span");e.textContent=h[t];e.style.color=this._colors[t];o.appendChild(e)}a.appendChild(o);a.style.height=h.length*C+"px";let c=new i(a,this._colors);c.init(S,C,h.length);e.graph=c;e.values=new Array(h.length);s.appendChild(a)}}t.appendChild(this._root)}item(t){if(!t){return null}let e=this._id2counter[t];if(e){return e}let i=this._values[t];if(!i){return null}if(i.extension){let n=i.extension.indexOf(".");let s=i.extension.substring(0,n);let a=this._name2extStats[s];if(!a){console.error(`extension ${s} not found, make sure you have register and enable it.`);return null}e=a.counter(t,i)}else{e=new s(t,i)}this._id2counter[t]=e;return e}tick(){for(let t in this._name2extStats){let e=this._name2extStats[t];e.tick()}for(let t in this._values){let e=this._id2counter[t];if(e){e.sample();let i=e.alarm();let n=e.human();let s=this._id2item[t];s.label.classList.toggle("alarm",i>0);s.valueText.nodeValue=n;s.graph.draw(e.value,i)}}for(let t=0;t<this._fractions.length;++t){let e=this._fractions[t];let i=this._id2counter[e.base];if(i){let t=e.steps;for(let n=0;n<t.length;++n){let s=t[n];let a=this._id2counter[s];if(a){e.values[n]=a.value/i.value}}e.graph.draw(e.values)}}}}t();let R={new(t,e){let i=new E(t,e);return function(t){if(!t){return i}return i.item(t)}},register(t,e){y[t]=e}};return R}();
//# sourceMappingURL=./dist/pstats.min.js.map