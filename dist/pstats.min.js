var pstats=function(){"use strict";function t(){if(typeof window.performance==="undefined"){window.performance={}}if(!window.performance.now){let t=Date.now();if(performance.timing&&performance.timing.navigationStart){t=performance.timing.navigationStart}window.performance.now=function i(){return Date.now()-t}}if(!window.performance.mark){window.performance.mark=function(){}}if(!window.performance.measure){window.performance.measure=function(){}}if(!window.performance.memory){window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}}}class i{constructor(t,i){this._color=i||"#666";this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvasDot=document.createElement("canvas");this._ctxDot=this._canvasDot.getContext("2d");this._canvasAlarm=document.createElement("canvas"),this._ctxAlarm=this._canvasAlarm.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,i){this._canvas.width=t;this._canvas.height=i;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${i}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,t,i);this._canvasDot.width=1;this._canvasDot.height=2*i;this._ctxDot.fillStyle="#444";this._ctxDot.fillRect(0,0,1,2*i);this._ctxDot.fillStyle=this._color;this._ctxDot.fillRect(0,i,1,i);this._ctxDot.fillStyle="#fff";this._ctxDot.globalAlpha=.5;this._ctxDot.fillRect(0,i,1,1);this._ctxDot.globalAlpha=1;this._canvasAlarm.width=1;this._canvasAlarm.height=2*i;this._ctxAlarm.fillStyle="#444";this._ctxAlarm.fillRect(0,0,1,2*i);this._ctxAlarm.fillStyle="#b70000";this._ctxAlarm.fillRect(0,i,1,i);this._ctxAlarm.globalAlpha=.5;this._ctxAlarm.fillStyle="#fff";this._ctxAlarm.fillRect(0,i,1,1);this._ctxAlarm.globalAlpha=1}}class e extends i{constructor(t,i){super(t,i);this._current=0;this._max=0}draw(t,i){this._current+=(t-this._current)*.1;this._max*=.99;if(this._current>this._max){this._max=this._current}let e=Math.round(-this._canvas.height*this._current/this._max);this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(i){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,e)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,e)}}}class s extends i{constructor(t,i){super(t,i);this._threshold=0;this._canvas2=document.createElement("canvas");this._ctx2=this._canvas2.getContext("2d")}init(t,i){super.init(t,i);this._canvas2.width=t;this._canvas2.height=i;this._ctx2.fillStyle="#444";this._ctx2.fillRect(0,0,t,i)}draw(t,i){if(t>this._threshold){let i=(t-t%this._canvas.height)/this._canvas.height;let e=this._canvas.height*(i+1);let s=this._threshold;this._threshold=e;let a=s/e;this._ctx2.drawImage(this._canvas,0,0);this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height);this._ctx.drawImage(this._canvas2,1,0,this._canvas.width-1,this._canvas.height,0,(1-a)*this._canvas.height,this._canvas.width-1,this._canvas.height)}else{this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height)}let e=Math.round(-this._canvas.height*t/this._threshold);if(i){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,e)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,e)}}}class a extends i{constructor(t,i,e,s){super(t,i);this._min=e;this._max=s}draw(t,i){let e=(t-this._min)/(this._max-this._min);let s=-Math.ceil(this._canvas.height*e);this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(i){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,s)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,s)}}}class n{constructor(t,i){this._colors=i;this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,i,e){this._canvas.width=t;this._canvas.height=i*e;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${i*e}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,t,i*e)}draw(t){this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);let i=0;for(let e=0;e<t.length;++e){let s=t[e]*this._canvas.height;this._ctx.fillStyle=this._colors[e];this._ctx.fillRect(this._canvas.width-1,i,1,s);i+=s}}}class h{constructor(t,i){this._id=t;this._opts=i||{};this._value=0;this._total=0;this._averageValue=0;this._accumValue=0;this._accumSamples=0;this._accumStart=window.performance.now()}_average(t){if(this._opts.average){this._accumValue+=t;++this._accumSamples;let i=performance.now();if(i-this._accumStart>=this._opts.average){this._averageValue=this._accumValue/this._accumSamples;this._accumValue=0;this._accumStart=i;this._accumSamples=0}}}get value(){return this._value}set value(t){this._value=t}sample(){this._average(this._value)}human(){let t=this._opts.average?this._averageValue:this._value;return Math.round(t*100)/100}alarm(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}}class c extends h{constructor(t,i){super(t,i);this._time=window.performance.now()}start(){this._time=window.performance.now()}end(){this._value=window.performance.now()-this._time;this._average(this._value)}tick(){this.end();this.start()}frame(){let t=window.performance.now();let i=t-this._time;this._total++;let e=this._opts.average||1e3;if(i>e){this._value=this._total*1e3/i;this._total=0;this._time=t;this._average(this._value)}}}const o=Math.log(1024);const r=["Bytes","KB","MB","GB","TB"];function l(t){let i=100;let e=Math.floor(Math.log(t)/o);if(t===0){return"n/a"}return Math.round(t*i/Math.pow(1024,e))/i+" "+r[e]}class _ extends h{constructor(t,i,e){super(i,e);this._stats=t;this._start=0;if(e.extension.indexOf("memory.")===0){this._field=e.extension.substring(7)}}snapshot(){this._value=this._stats[this._field]}start(){this._start=this._stats[this._field]}end(){this._value=this._stats[this._field]-this._start}human(){return l(super.human())}}class u{constructor(){let t=window.performance.memory;if(t.totalJSHeapSize===0){console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome.")}this._used=0;this._total=0;this._lastUsed=0}tick(){this._lastUsed=this._used;this._used=window.performance.memory.usedJSHeapSize;this._total=window.performance.memory.totalJSHeapSize}get alarm(){return this._used-this._lastUsed<0}get used(){return window.performance.memory.usedJSHeapSize}get total(){return this._total}counter(t,i){return new _(this,t,i)}}let m={memory:u};let d=100;let f=10;let v=`
  .pstats {
    position: absolute;
    z-index: 9999;

    padding: 5px;
    width: ${d+150}px;
    right: 0;
    bottom: 0;

    font-size: 10px;
    font-family: 'Roboto Condensed', tahoma, sans-serif;
    overflow: hidden;
    user-select: none;
    cursor: default;

    background: #222;
    border-radius: 3px;

  }

  .pstats-container {
    display: flex;
    flex-direction: column;
    color: #888;
    white-space: nowrap;
  }

  .pstats-item {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .pstats-label {
    display: flex;
    flex-direction: row;
    flex: 1;

    text-align: left;
    margin-right: 5px;

    transition: background 0.3s;
  }

  .pstats-label.alarm {
    color: #ccc;
    background: #800;

    transition: background 0s;
  }

  .pstats-counter-id {
    flex: 1;
  }

  .pstats-counter-value {
    flex: 1;
    text-align: right;
  }

  .pstats-fraction {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: 1px;
    margin-bottom: 1px;
  }

  .pstats-legend {
    display: flex;
    flex-direction: column;
    flex: 1;

    text-align: right;
    margin-right: 5px;
  }
`;let p=document.createElement("style");p.type="text/css";p.textContent=v;document.head.appendChild(p);class w{constructor(t,i){i=i||{};this._values=i.values||{};this._fractions=i.fractions||[];this._id2counter={};this._id2item={};this._name2extStats={};if(i.css){let t=document.createElement("style");t.type="text/css";t.textContent=i.css;document.head.appendChild(t)}if(i.extensions){for(let t=0;t<i.extensions.length;++t){let e=i.extensions[t];let s=m[e];if(!s){console.warn(`Can not find extensions ${e}, please register your extension via pstats.register().`);continue}this._name2extStats[e]=new s}}this._root=document.createElement("div");this._root.className="pstats";let h=document.createElement("div");h.className="pstats-container";this._root.appendChild(h);for(let t in this._values){let i=this._values[t];let n=document.createElement("div");n.className="pstats-item";let c=document.createElement("div");c.className="pstats-label";let o=document.createElement("span");o.className="pstats-counter-id";o.textContent=i.desc||t;let r=document.createElement("div");r.className="pstats-counter-value";let l=document.createTextNode("");l.nodeValue="0";c.appendChild(o);c.appendChild(r);r.appendChild(l);n.appendChild(c);let _;if(i.min!==undefined||i.max!==undefined){_=new a(n,i.color,i.min||0,i.max||9999)}else if(i.threshold){_=new s(n,i.color)}else{_=new e(n,i.color)}_.init(d,f);this._id2item[t]={label:c,valueText:l,graph:_};h.appendChild(n)}if(i.fractions){for(let t=0;t<i.fractions.length;++t){let e=i.fractions[t];e.colors=e.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];let s=document.createElement("div");s.className="pstats-fraction";let a=document.createElement("div");a.className="pstats-legend";let c=e.steps;for(let t=0;t<c.length;++t){let i=document.createElement("span");i.textContent=c[t];i.style.color=e.colors[t];a.appendChild(i)}s.appendChild(a);s.style.height=c.length*f+"px";let o=new n(s,e.colors);o.init(d,f,c.length);e.graph=o;e.values=new Array(c.length);h.appendChild(s)}}t.appendChild(this._root)}item(t){if(!t){return null}let i=this._id2counter[t];if(i){return i}let e=this._values[t];if(!e){return null}if(e.extension){let s=e.extension.indexOf(".");let a=e.extension.substring(0,s);let n=this._name2extStats[a];if(!n){console.error(`extension ${a} not found, make sure you have register and enable it.`);return null}i=n.counter(t,e)}else{i=new c(t,e)}this._id2counter[t]=i;return i}tick(){for(let t in this._name2extStats){let i=this._name2extStats[t];i.tick()}for(let t in this._values){let i=this._id2counter[t];if(i){i.sample();let e=i.alarm();let s=i.human();let a=this._id2item[t];a.label.classList.toggle("alarm",e>0);a.valueText.nodeValue=s;a.graph.draw(i.value,e)}}for(let t=0;t<this._fractions.length;++t){let i=this._fractions[t];let e=this._id2counter[i.base];if(e){let t=i.steps;for(let s=0;s<t.length;++s){let a=t[s];let n=this._id2counter[a];if(n){i.values[s]=n.value/e.value}}i.graph.draw(i.values)}}}}t();let g={new(t,i){let e=new w(t,i);return function(t){if(!t){return e}return e.item(t)}},register(t,i){m[t]=i}};return g}();
//# sourceMappingURL=./dist/pstats.min.js.map