var pstats=function(){"use strict";function t(){if(typeof window.performance==="undefined"){window.performance={}}if(!window.performance.now){var t=Date.now();if(performance.timing&&performance.timing.navigationStart){t=performance.timing.navigationStart}window.performance.now=function e(){return Date.now()-t}}if(!window.performance.mark){window.performance.mark=function(){}}if(!window.performance.measure){window.performance.measure=function(){}}if(!window.performance.memory){window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}}}class e{constructor(t,e){this._color=e||"#666";this._max=0;this._current=0;this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvasDot=document.createElement("canvas");this._ctxDot=this._canvasDot.getContext("2d");this._canvasAlarm=document.createElement("canvas"),this._ctxAlarm=this._canvasAlarm.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,e){this._canvas.width=t;this._canvas.height=e;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${e}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height);this._canvasDot.width=1;this._canvasDot.height=2*e;this._ctxDot.fillStyle="#444";this._ctxDot.fillRect(0,0,1,2*e);this._ctxDot.fillStyle=this._color;this._ctxDot.fillRect(0,e,1,e);this._ctxDot.fillStyle="#fff";this._ctxDot.globalAlpha=.5;this._ctxDot.fillRect(0,e,1,1);this._ctxDot.globalAlpha=1;this._canvasAlarm.width=1;this._canvasAlarm.height=2*e;this._ctxAlarm.fillStyle="#444";this._ctxAlarm.fillRect(0,0,1,2*e);this._ctxAlarm.fillStyle="#b70000";this._ctxAlarm.fillRect(0,e,1,e);this._ctxAlarm.globalAlpha=.5;this._ctxAlarm.fillStyle="#fff";this._ctxAlarm.fillRect(0,e,1,1);this._ctxAlarm.globalAlpha=1}draw(t,e){this._current+=(t-this._current)*.1;this._max*=.99;if(this._current>this._max){this._max=this._current}this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(e){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,-this._canvas.height*this._current/this._max)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,-this._canvas.height*this._current/this._max)}}}class i{constructor(t,e){this._colors=e;this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,e,i){this._canvas.width=t;this._canvas.height=e*i;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${e*i}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,t,e*i)}draw(t){this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);let e=0;for(let i=0;i<t.length;++i){let a=t[i]*this._canvas.height;this._ctx.fillStyle=this._colors[i];this._ctx.fillRect(this._canvas.width-1,e,1,a);e+=a}}}class a{constructor(t,e){this._id=t;this._opts=e||{};this._idstart=`${t}_start`;this._idend=`${t}_end`;this._value=0;this._total=0;this._averageValue=0;this._accumValue=0;this._accumStart=window.performance.now();this._accumSamples=0;this._started=false;this._time=performance.now()}_average(t){if(this._opts.average){this._accumValue+=t;++this._accumSamples;let e=performance.now();if(e-this._accumStart>=(this._opts.avgMs||1e3)){this._averageValue=this._accumValue/this._accumSamples;this._accumValue=0;this._accumStart=e;this._accumSamples=0}}}get value(){return this._value}set value(t){this._value=t;this._average(this._value)}start(){this._time=window.performance.now();window.performance.mark(this._idstart);this._started=true}end(){this._value=window.performance.now()-this._time;window.performance.mark(this._idend);if(this._started){window.performance.measure(this._id,this._idstart,this._idend)}this._average(this._value)}tick(){this.end();this.start()}frame(){let t=window.performance.now();let e=t-this._time;this._total++;if(e>1e3){if(this._opts.interpolate){this._value=this._total*1e3/e}else{this._value=this._total}this._total=0;this._time=t;this._average(this._value)}}sampleAverage(){let t=this._opts.average?this._averageValue:this._value;return Math.round(t*100)/100}sampleAlarm(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}}let s=100;let n=10;let h=`
  .pstats {
    position: absolute;
    z-index: 9999;

    padding: 5px;
    width: ${s+150}px;
    right: 0;
    bottom: 0;

    font-size: 10px;
    font-family: 'Roboto Condensed', tahoma, sans-serif;
    overflow: hidden;
    user-select: none;
    cursor: default;

    background: rgba(0,0,0,0.2);
    border-radius: 3px;

  }

  .pstats-container {
    display: flex;
    flex-direction: column;
    color: #888;
  }

  .pstats-item {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .pstats-label {
    display: flex;
    flex-direction: row;
    flex: 1;

    text-align: left;
    margin-right: 5px;

    transition: background 0.3s;
  }

  .pstats-label.alarm {
    color: #ccc;
    background: #800;

    transition: background 0s;
  }

  .pstats-counter-id {
    flex: 1;
  }

  .pstats-counter-value {
    width: 30px;
    text-align: right;
  }

  .pstats-fraction {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .pstats-legend {
    display: flex;
    flex-direction: column;
    flex: 1;

    text-align: right;
    margin-right: 5px;
  }
`;let c=document.createElement("style");c.type="text/css";c.textContent=h;document.head.appendChild(c);class o{constructor(t,a){a=a||{};this._colors=a.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];this._values=a.values||{};this._fractions=a.fractions||[];this._id2perf={};this._id2item={};if(a.css){let t=document.createElement("style");t.type="text/css";t.textContent=a.css;document.head.appendChild(t)}this._root=document.createElement("div");this._root.className="pstats";let h=document.createElement("div");h.className="pstats-container";this._root.appendChild(h);for(let t in this._values){let i=this._values[t];let a=document.createElement("div");a.className="pstats-item";let c=document.createElement("div");c.className="pstats-label";let o=document.createElement("span");o.className="pstats-counter-id";o.textContent=i.desc||t;let r=document.createElement("div");r.className="pstats-counter-value";let l=document.createTextNode("");l.nodeValue="0";c.appendChild(o);c.appendChild(r);r.appendChild(l);a.appendChild(c);let _=new e(a,i.color);_.init(s,n);this._id2item[t]={label:c,valueText:l,graph:_};h.appendChild(a)}if(a.fractions){for(let t=0;t<a.fractions.length;++t){let e=a.fractions[t];let c=document.createElement("div");c.className="pstats-fraction";let o=document.createElement("div");o.className="pstats-legend";let r=e.steps;for(let t=0;t<r.length;++t){let e=document.createElement("span");e.textContent=r[t];e.style.color=this._colors[t];o.appendChild(e)}c.appendChild(o);c.style.height=r.length*n+"px";e.dom=c;let l=new i(c,this._colors);l.init(s,n,r.length);e.graph=l;h.appendChild(c)}}t.appendChild(this._root)}item(t){if(!t){return null}t=t.toLowerCase();let e=this._id2perf[t];if(e){return e}let i=this._values[t];e=new a(t,i);this._id2perf[t]=e;return e}tick(){for(let t in this._values){let e=this._id2perf[t];if(e){let i=e.sampleAverage();let a=e.sampleAlarm();let s=this._id2item[t];s.label.classList.toggle("alarm",a>0);s.valueText.nodeValue=i;s.graph.draw(e.value,a)}}for(let t=0;t<this._fractions.length;++t){let e=this._fractions[t];let i=[];let a=this._id2perf[e.base.toLowerCase()];if(a){let t=e.steps;for(let e=0;e<t.length;++e){let s=t[e].toLowerCase();let n=this._id2perf[s];if(n){i.push(n.value/a.value)}}e.graph.draw(i)}}}}t();let r={new(t,e){let i=new o(t,e);return function(t){if(!t){return i}return i.item(t)}}};return r}();
//# sourceMappingURL=./dist/pstats.min.js.map