var pstats=function(){"use strict";function t(){if(typeof window.performance==="undefined"){window.performance={}}if(!window.performance.now){var t=Date.now();if(performance.timing&&performance.timing.navigationStart){t=performance.timing.navigationStart}window.performance.now=function e(){return Date.now()-t}}if(!window.performance.mark){window.performance.mark=function(){}}if(!window.performance.measure){window.performance.measure=function(){}}if(!window.performance.memory){window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}}}class e{constructor(t,e){this._color=e||"#666";this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvasDot=document.createElement("canvas");this._ctxDot=this._canvasDot.getContext("2d");this._canvasAlarm=document.createElement("canvas"),this._ctxAlarm=this._canvasAlarm.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,e){this._canvas.width=t;this._canvas.height=e;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${e}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,t,e);this._canvasDot.width=1;this._canvasDot.height=2*e;this._ctxDot.fillStyle="#444";this._ctxDot.fillRect(0,0,1,2*e);this._ctxDot.fillStyle=this._color;this._ctxDot.fillRect(0,e,1,e);this._ctxDot.fillStyle="#fff";this._ctxDot.globalAlpha=.5;this._ctxDot.fillRect(0,e,1,1);this._ctxDot.globalAlpha=1;this._canvasAlarm.width=1;this._canvasAlarm.height=2*e;this._ctxAlarm.fillStyle="#444";this._ctxAlarm.fillRect(0,0,1,2*e);this._ctxAlarm.fillStyle="#b70000";this._ctxAlarm.fillRect(0,e,1,e);this._ctxAlarm.globalAlpha=.5;this._ctxAlarm.fillStyle="#fff";this._ctxAlarm.fillRect(0,e,1,1);this._ctxAlarm.globalAlpha=1}}class i extends e{constructor(t,e){super(t,e);this._current=0;this._max=0}draw(t,e){this._current+=(t-this._current)*.1;this._max*=.99;if(this._current>this._max){this._max=this._current}let i=Math.round(-this._canvas.height*this._current/this._max);this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(e){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,i)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,i)}}}class s extends e{constructor(t,e){super(t,e);this._current=0;this._threshold=0;this._canvas2=document.createElement("canvas");this._ctx2=this._canvas2.getContext("2d")}init(t,e){super.init(t,e);this._canvas2.width=t;this._canvas2.height=e;this._ctx2.fillStyle="#444";this._ctx2.fillRect(0,0,t,e)}draw(t,e){this._current=t;if(this._current>this._threshold){let t=(this._current-this._current%this._canvas.height)/this._canvas.height;let e=this._canvas.height*(t+1);let i=this._threshold;this._threshold=e;let s=i/e;this._ctx2.drawImage(this._canvas,0,0);this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height);this._ctx.drawImage(this._canvas2,1,0,this._canvas.width-1,this._canvas.height,0,(1-s)*this._canvas.height,this._canvas.width-1,this._canvas.height)}else{this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height)}let i=Math.round(-this._canvas.height*this._current/this._threshold);if(e){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,i)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,i)}}}class n extends e{constructor(t,e,i,s){super(t,e);this._current=0;this._min=i;this._max=s}draw(t,e){this._current=t;let i=(this._current-this._min)/(this._max-this._min);let s=-Math.ceil(this._canvas.height*i);this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);if(e){this._ctx.drawImage(this._canvasAlarm,this._canvas.width-1,s)}else{this._ctx.drawImage(this._canvasDot,this._canvas.width-1,s)}}}class a{constructor(t,e){this._colors=e;this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._canvas.className="pstats-canvas";t.appendChild(this._canvas)}init(t,e,i){this._canvas.width=t;this._canvas.height=e*i;this._canvas.style.width=`${t}px`;this._canvas.style.height=`${e*i}px`;this._ctx.fillStyle="#444";this._ctx.fillRect(0,0,t,e*i)}draw(t){this._ctx.drawImage(this._canvas,1,0,this._canvas.width-1,this._canvas.height,0,0,this._canvas.width-1,this._canvas.height);let e=0;for(let i=0;i<t.length;++i){let s=t[i]*this._canvas.height;this._ctx.fillStyle=this._colors[i];this._ctx.fillRect(this._canvas.width-1,e,1,s);e+=s}}}class h{constructor(t,e){this._id=t;this._opts=e||{};this._value=0;this._total=0;this._averageValue=0;this._accumValue=0;this._accumSamples=0;this._accumStart=window.performance.now()}_average(t){if(this._opts.average){this._accumValue+=t;++this._accumSamples;let e=performance.now();if(e-this._accumStart>=this._opts.average){this._averageValue=this._accumValue/this._accumSamples;this._accumValue=0;this._accumStart=e;this._accumSamples=0}}}get value(){return this._value}set value(t){this._value=t}sample(){this._average(this._value)}human(){let t=this._opts.average?this._averageValue:this._value;return Math.round(t*100)/100}alarm(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}}class c extends h{constructor(t,e){super(t,e);this._time=performance.now()}start(){this._time=window.performance.now()}end(){this._value=window.performance.now()-this._time;this._average(this._value)}tick(){this.end();this.start()}frame(){let t=window.performance.now();let e=t-this._time;this._total++;let i=this._opts.average||1e3;if(e>i){this._value=this._total*1e3/e;this._total=0;this._time=t;this._average(this._value)}}}const r=Math.log(1024);const o=["Bytes","KB","MB","GB","TB"];function l(t){let e=100;let i=Math.floor(Math.log(t)/r);if(t===0){return"n/a"}return Math.round(t*e/Math.pow(1024,i))/e+" "+o[i]}class _ extends h{constructor(t,e,i){super(e,i);this._stats=t;this._start=0;if(i.extension.indexOf("memory.")===0){this._field=i.extension.substring(7)}}snapshot(){this._value=this._stats[this._field]}start(){this._start=this._stats[this._field]}end(){this._value=this._stats[this._field]-this._start}human(){return l(super.human())}}class u{constructor(){let t=window.performance.memory;if(t.totalJSHeapSize===0){console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome.")}this._used=0;this._total=0;this._lastUsed=0}tick(){let t=window.performance.memory.usedJSHeapSize;this._lastUsed=this._used;this._used=t;this._total=window.performance.memory.totalJSHeapSize}get alarm(){return this._used-this._lastUsed<0}get used(){return this._used}get total(){return this._total}counter(t,e){return new _(this,t,e)}}let f=false;let d=0;let m=0;let v=0;let p=0;let g=0;let w=0;let x=0;function y(){if(f){return}f=true;function t(t,e){return function(){e.apply(this,arguments);t.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=t(WebGLRenderingContext.prototype.drawArrays,function(){d++;if(arguments[0]==this.POINTS)w+=arguments[2];else g+=arguments[2]});WebGLRenderingContext.prototype.drawElements=t(WebGLRenderingContext.prototype.drawElements,function(){m++;p+=arguments[1]/3;g+=arguments[1]});WebGLRenderingContext.prototype.useProgram=t(WebGLRenderingContext.prototype.useProgram,function(){v++});WebGLRenderingContext.prototype.bindTexture=t(WebGLRenderingContext.prototype.bindTexture,function(){x++})}class S extends h{constructor(t,e,i){super(e,i);this._stats=t;this._start=0;if(i.extension.indexOf("webgl.")===0){this._field=i.extension.substring(6)}}snapshot(){this._value=this._stats[this._field]}start(){this._start=this._stats[this._field]}end(){this._value=this._stats[this._field]-this._start}}class C{constructor(){y()}tick(){d=0;m=0;v=0;p=0;g=0;w=0;x=0}counter(t,e){return new S(this,t,e)}get drawcalls(){return d+m}get drawArrays(){return d}get drawElements(){return m}get faces(){return p}get vertices(){return g}get points(){return w}get programs(){return v}get textures(){return x}}let b={memory:u,webgl:C};let A=100;let R=10;let D=`
  .pstats {
    position: absolute;
    z-index: 9999;

    padding: 5px;
    width: ${A+150}px;
    right: 0;
    bottom: 0;

    font-size: 10px;
    font-family: 'Roboto Condensed', tahoma, sans-serif;
    overflow: hidden;
    user-select: none;
    cursor: default;

    background: #222;
    border-radius: 3px;

  }

  .pstats-container {
    display: flex;
    flex-direction: column;
    color: #888;
    white-space: nowrap;
  }

  .pstats-item {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .pstats-label {
    display: flex;
    flex-direction: row;
    flex: 1;

    text-align: left;
    margin-right: 5px;

    transition: background 0.3s;
  }

  .pstats-label.alarm {
    color: #ccc;
    background: #800;

    transition: background 0s;
  }

  .pstats-counter-id {
    flex: 1;
  }

  .pstats-counter-value {
    flex: 1;
    text-align: right;
  }

  .pstats-fraction {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: 1px;
    margin-bottom: 1px;
  }

  .pstats-legend {
    display: flex;
    flex-direction: column;
    flex: 1;

    text-align: right;
    margin-right: 5px;
  }
`;let E=document.createElement("style");E.type="text/css";E.textContent=D;document.head.appendChild(E);class I{constructor(t,e){e=e||{};this._values=e.values||{};this._fractions=e.fractions||[];this._id2counter={};this._id2item={};this._name2extStats={};if(e.css){let t=document.createElement("style");t.type="text/css";t.textContent=e.css;document.head.appendChild(t)}if(e.extensions){for(let t=0;t<e.extensions.length;++t){let i=e.extensions[t];let s=b[i];if(!s){console.warn(`Can not find extensions ${i}, please register your extension via pstats.register().`);continue}this._name2extStats[i]=new s}}this._root=document.createElement("div");this._root.className="pstats";let h=document.createElement("div");h.className="pstats-container";this._root.appendChild(h);for(let t in this._values){let e=this._values[t];let a=document.createElement("div");a.className="pstats-item";let c=document.createElement("div");c.className="pstats-label";let r=document.createElement("span");r.className="pstats-counter-id";r.textContent=e.desc||t;let o=document.createElement("div");o.className="pstats-counter-value";let l=document.createTextNode("");l.nodeValue="0";c.appendChild(r);c.appendChild(o);o.appendChild(l);a.appendChild(c);let _;if(e.min!==undefined||e.max!==undefined){_=new n(a,e.color,e.min||0,e.max||9999)}else if(e.threshold){_=new s(a,e.color)}else{_=new i(a,e.color)}_.init(A,R);this._id2item[t]={label:c,valueText:l,graph:_};h.appendChild(a)}if(e.fractions){for(let t=0;t<e.fractions.length;++t){let i=e.fractions[t];i.colors=i.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];let s=document.createElement("div");s.className="pstats-fraction";let n=document.createElement("div");n.className="pstats-legend";let c=i.steps;for(let t=0;t<c.length;++t){let e=document.createElement("span");e.textContent=c[t];e.style.color=i.colors[t];n.appendChild(e)}s.appendChild(n);s.style.height=c.length*R+"px";let r=new a(s,i.colors);r.init(A,R,c.length);i.graph=r;i.values=new Array(c.length);h.appendChild(s)}}t.appendChild(this._root)}item(t){if(!t){return null}let e=this._id2counter[t];if(e){return e}let i=this._values[t];if(!i){return null}if(i.extension){let s=i.extension.indexOf(".");let n=i.extension.substring(0,s);let a=this._name2extStats[n];if(!a){console.error(`extension ${n} not found, make sure you have register and enable it.`);return null}e=a.counter(t,i)}else{e=new c(t,i)}this._id2counter[t]=e;return e}tick(){for(let t in this._name2extStats){let e=this._name2extStats[t];e.tick()}for(let t in this._values){let e=this._id2counter[t];if(e){e.sample();let i=e.alarm();let s=e.human();let n=this._id2item[t];n.label.classList.toggle("alarm",i>0);n.valueText.nodeValue=s;n.graph.draw(e.value,i)}}for(let t=0;t<this._fractions.length;++t){let e=this._fractions[t];let i=this._id2counter[e.base];if(i){let t=e.steps;for(let s=0;s<t.length;++s){let n=t[s];let a=this._id2counter[n];if(a){e.values[s]=a.value/i.value}}e.graph.draw(e.values)}}}}t();let N={new(t,e){let i=new I(t,e);return function(t){if(!t){return i}return i.item(t)}},register(t,e){b[t]=e}};return N}();
//# sourceMappingURL=./dist/pstats.min.js.map