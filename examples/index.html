<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Example: Simple</title>
    <style>
      body {
        text-align: center;
        background: #333;

        position: absolute;
        top: 0; bottom: 0; left: 0; right: 0;
        display: flex;
        flex-direction: column;

        /*user-select: none;
        cursor: default;*/
      }

      h2 {
        color: #f90;
      }
    </style>
    <script src="../dist/pstats.dev.js"></script>
  </head>

  <body>
    <h2>pstats</h2>
    <script>
      'use strict';

      let stats = pstats.new(document.body, {
        values: {
          frame: { desc: 'Total frame time (ms)', over: 18, average: 100 },
          raf: { desc: 'Time since last rAF (ms)', average: 100 },
          fps: { desc: 'Framerate (FPS)', below: 30, average: 500 },
          render1: { desc: 'WebGL Render 01 (ms)' },
          render2: { desc: 'WebGL Render 02 (ms)' },
          user: { desc: 'user value' },
          memory: { desc: 'Memory', extension: 'memory.used', average: 1000 },
          drawcalls: { desc: 'Draw Calls', extension : 'webgl.drawcalls' },
        },
        fractions: [
          { base: 'frame', steps: ['render1', 'render2'] }
        ],
        extensions: [
          'memory', 'webgl'
        ],
      });

      function delay() {
        let d = Math.random() * 10;
        let now = Date.now();
        let s = now + d;
        while (now < s) {
          now = Date.now();
        }
      }

      let i = 0;

      function render() {
        stats('memory').snapshot();
        stats('drawcalls').snapshot();

        stats('frame').start();
          stats('raf').tick();
          stats('fps').frame();

          stats('render1').start();
            delay();
          stats('render1').end();

          stats('render2').start();
            delay();
          stats('render2').end();
        stats('frame').end();

        stats('user').value = i;
        i += 0.1;

        stats().tick();
        requestAnimationFrame(render);
      }

      render();
    </script>
  </body>
</html>
